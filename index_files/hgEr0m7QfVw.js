if (self.CavalryLogger) { CavalryLogger.start_js(["nLgBV"]); }

__d('MercuryJewelCountControl',['Arbiter','Bootloader','CurrentUser','MercuryConfig','MercuryDispatcher','MercuryThreadInformer','MercuryUnseenState','MercuryUnreadState','UserActivity','isInFocusMode'],(function a(b,c,d,e,f,g){function h(i,j){'use strict';this.$MercuryJewelCountControl3=false;this.$MercuryJewelCountControl2={};this.$MercuryJewelCountControl3=false;Object.keys(j).forEach(function(k){this.$MercuryJewelCountControl2[k]=c('MercuryUnseenState').getForFBID(k);}.bind(this));this.$MercuryJewelCountControl4();this.render();Object.keys(j).forEach(function(k){c('MercuryDispatcher').getForFBID(k).subscribe('model-update-completed',function(l,m){this.$MercuryJewelCountControl5(k);}.bind(this));c('MercuryThreadInformer').getForFBID(k).subscribe('unseen-updated',function(){return this.render();}.bind(this));}.bind(this));this.$MercuryJewelCountControl1=i;this.$MercuryJewelCountControl1.subscribe('marked-seen',function(){this.$MercuryJewelCountControl6();}.bind(this));}h.prototype.render=function(){'use strict';var i=0;if(!c('isInFocusMode')())i=Object.keys(this.$MercuryJewelCountControl2).reduce(function(j,k){var l=k==c('CurrentUser').getID()||!!this.$MercuryJewelCountControl3;return l?j+this.$MercuryJewelCountControl2[k].getUnseenCount():j;}.bind(this),0);c('Arbiter').inform('jewel/count-updated',{jewel:'mercurymessages',count:i},c('Arbiter').BEHAVIOR_STATE);};h.prototype.$MercuryJewelCountControl4=function(){var i,j=this;'use strict';if(c('MercuryConfig').PagesTabConfig&&c('MercuryConfig').PagesTabConfig.unseenJewelEnabled)(function(){j.$MercuryJewelCountControl3=true;var k=c('MercuryConfig').PagesTabConfig;c('Bootloader').loadModules(["MercurySyncPageEnvironment"],function(l){return l.setUp(k.pageID,k.irisPageSeqID);},'MercuryJewelCountControl');})();};h.prototype.$MercuryJewelCountControl6=function(){'use strict';Object.keys(this.$MercuryJewelCountControl2).forEach(function(i){this.$MercuryJewelCountControl2[i].markAsSeen();}.bind(this));};h.prototype.$MercuryJewelCountControl5=function(i){'use strict';if(this.$MercuryJewelCountControl1.isOpen()&&c('UserActivity').isActive())this.$MercuryJewelCountControl2[i]&&this.$MercuryJewelCountControl2[i].markAsSeen();};h.constructStores=function(i){'use strict';Object.keys(i).forEach(function(j){c('MercuryUnseenState').getForFBID(j);c('MercuryUnreadState').getForFBID(j);});};f.exports=h;}),null);
__d('MessagesJewelThreadlistRowContainer.react',['ChatOpenTab','ChatOpenTabEventLogger','FantaTabActions','ImmutableObject','MercuryDelayedRoger','MercuryThreadlistRowContainer.react','MessagesJewelThreadListRow.react','ReactComponentWithPureRenderMixin','React','StoreAndPropBasedStateMixin'],(function a(b,c,d,e,f,g){'use strict';var h=c('MercuryDelayedRoger').get(),i=c('React').PropTypes,j=c('React').createClass({displayName:'MessagesJewelThreadlistRowContainer',mixins:[c('ReactComponentWithPureRenderMixin'),c('StoreAndPropBasedStateMixin')(h)],propTypes:{thread:i.instanceOf(c('ImmutableObject')).isRequired,viewer:i.string.isRequired},statics:{calculateState:function k(l){return {wasSeenByAll:h.wasSeenByAll(l.thread.thread_id)};}},render:function k(){return c('React').createElement(c('MercuryThreadlistRowContainer.react'),{ChildClass:c('MessagesJewelThreadListRow.react'),onClick:this._handleClick,showPresence:c('ChatOpenTab').canOpenTab(),thread:this.props.thread,viewer:this.props.viewer,wasSeenByAll:this.state.wasSeenByAll});},_handleClick:function k(l){if(l.button===1||l.altKey||l.ctrlKey||l.metaKey||l.shiftKey)return;if(!c('ChatOpenTab').canOpenTab())return;l.preventDefault();var m=this.props.thread.thread_id;c('FantaTabActions').openTab(m);c('ChatOpenTabEventLogger').log('jewel',m);}});f.exports=j;}),null);
__d('MessagesJewelThreadList.react',['cx','fbt','BootloadedComponent.react','EventProfiler','ImmutableObject','JSResource','Link.react','MercuryConfig','MercuryMessageBlockingNuxContainer.react','MessageBlockNuxState','MessagesJewelThreadlistRowContainer.react','MessagingTag','React','ScrollableArea.react','XUISpinner.react','debounce','getViewportDimensions','throttle'],(function a(b,c,d,e,f,g,h,i){'use strict';var j,k,l=160,m=600,n=c('React').PropTypes;j=babelHelpers.inherits(o,c('React').Component);k=j&&j.prototype;function o(){var p,q;for(var r=arguments.length,s=Array(r),t=0;t<r;t++)s[t]=arguments[t];return q=(p=k.constructor).call.apply(p,[this].concat(s)),this.$MessagesJewelThreadList3=function(){if(this.props.isLoaded)return;var u=this.refs.scrollable.getArea();if(u.getScrollTop()+u.getClientHeight()>=u.getScrollHeight()-1)this.props.onLoadMoreRequest&&this.props.onLoadMoreRequest();}.bind(this),this.$MessagesJewelThreadList9=function(u){u.preventDefault();this.props.onLoadMoreRequest&&this.props.onLoadMoreRequest();}.bind(this),this.$MessagesJewelThreadList10=function(u){if(this.props.onMessageRequestsClick)this.props.onMessageRequestsClick(u);}.bind(this),this.$MessagesJewelThreadList8=function(u){if(this.props.onFilteredRequestsClick)this.props.onFilteredRequestsClick(u);}.bind(this),this.state={height:this.$MessagesJewelThreadList2()},q;}o.prototype.componentDidMount=function(){this.$MessagesJewelThreadList1=Event.listen(window,'resize',c('debounce')(function(){this.setState({height:this.$MessagesJewelThreadList2()});}.bind(this)));c('EventProfiler').informManualInteractionTimestamp(['FirstMercuryThreadFetch'],true);};o.prototype.componentDidUpdate=function(p){if(p.threads.length===0&&this.props.threads.length!==0)this.props.onRenderThreads&&this.props.onRenderThreads();c('EventProfiler').informManualInteractionTimestamp(['FirstMercuryThreadFetch'],true);};o.prototype.componentWillUnmount=function(){this.$MessagesJewelThreadList1.remove();};o.prototype.render=function(){return c('React').createElement(c('ScrollableArea.react'),{className:"_2q3u",height:this.state.height,onScroll:c('throttle')(this.$MessagesJewelThreadList3,50),ref:'scrollable'},c('React').createElement('ul',{className:'jewelContent'},this.props.p2pJewelBannerContainer?c('React').createElement('li',null,this.props.p2pJewelBannerContainer):null,this.$MessagesJewelThreadList4(),this.$MessagesJewelThreadList5(),c('MessageBlockNuxState').shouldShowMessageBlockingNuxInJewel?c('React').createElement(c('MercuryMessageBlockingNuxContainer.react'),{shouldShowImage:true,location:'jewel'}):null,this.props.threads.map(function(p){return this.$MessagesJewelThreadList6(p);}.bind(this))),this.$MessagesJewelThreadList7());};o.prototype.$MessagesJewelThreadList6=function(p){if(Array.isArray(p)){return this.$MessagesJewelThreadList4(p);}else return c('React').createElement(c('MessagesJewelThreadlistRowContainer.react'),{key:p.thread_id,thread:p,viewer:this.props.viewer});};o.prototype.$MessagesJewelThreadList2=function(){return Math.min(m,c('getViewportDimensions')().height-l);};o.prototype.$MessagesJewelThreadList7=function(){if(this.props.isLoaded){if(this.props.folder===c('MessagingTag').PENDING)return c('React').createElement('div',{className:"_16bh _16bi"},c('React').createElement(c('Link.react'),{onClick:this.$MessagesJewelThreadList8},i._("See filtered requests")));return null;}if(this.props.isLoading)return c('React').createElement(c('XUISpinner.react'),{className:"jewelLoading"});return c('React').createElement('div',{className:"_v8y"},c('React').createElement(c('Link.react'),{href:'#',onClick:this.$MessagesJewelThreadList9},i._("Show Older")));};o.prototype.$MessagesJewelThreadList4=function(p){var q=c('MercuryConfig').MessengerInboxRequests,r=this.props.newMessageRequestThreads;if(q)r=p;if(!this.props.jewelRequestsUI&&!q||this.props.folder===c('MessagingTag').PENDING||!r||r.length===0)return null;return c('React').createElement(c('BootloadedComponent.react'),{key:r[0].thread_id,bootloadPlaceholder:c('React').createElement('li',{style:{height:60}}),bootloadLoader:c('JSResource')('MessagesJewelMessageRequestsRow.react').__setRef('MessagesJewelThreadList.react'),onClick:this.$MessagesJewelThreadList10,threads:r,viewer:this.props.viewer});};o.prototype.$MessagesJewelThreadList5=function(){if(!this.props.jewelRequestsUI||this.props.folder!==c('MessagingTag').PENDING)return null;return c('React').createElement('li',{className:"_16bh _16bi"},i._("Open a request to get more info about who's messaging you."),c('React').createElement('br',null),i._("They won't know you've seen it until you accept."));};o.propTypes={isLoaded:n.bool,isLoading:n.bool,jewelRequestsUI:n.bool,onFilteredRequestsClick:n.func,onLoadMoreRequest:n.func,onMessageRequestsClick:n.func,onRenderThreads:n.func,p2pJewelBannerContainer:n.element,threads:n.arrayOf(n.oneOfType([n.instanceOf(c('ImmutableObject')),n.arrayOf(n.instanceOf(c('ImmutableObject')))])).isRequired,viewer:n.string.isRequired};f.exports=o;}),null);
__d('MercuryJewelThreadlistControl',['csx','cx','fbt','ArbiterMixin','BootloadedComponent.react','CurrentUser','CSS','DOM','Event','JSLogger','JSResource','MercuryConfig','MercuryFilters','MercuryThreadlistConstants','MercuryThreadlistContainer.react','MessagesJewelThreadList.react','MessagingTag','MessengerURIConstants','PagesEventObserver','React','ReactDOM','MercuryThreadInformer','MercuryUnreadState','MercuryUnseenState','XUISpinner.react','mixin'],(function a(b,c,d,e,f,g,h,i,j){var k,l,m=c('JSLogger').create('mercury_jewel'),n=c('MessagingTag').PENDING,o='back_to_inbox',p=c('MessagingTag').INBOX,q=j._("See All in Messenger"),r=j._("See All Page Messages");k=babelHelpers.inherits(s,c('mixin')(c('ArbiterMixin')));l=k&&k.prototype;function s(t){'use strict';l.constructor.call(this);this.$JewelThreadlistControl17=function(v){v.preventDefault();this.$JewelThreadlistControl7(c('MessagingTag').PENDING,c('MercuryFilters').ALL);}.bind(this);this.$JewelThreadlistControl18=function(v){v.preventDefault();this.$JewelThreadlistControl7(c('MessagingTag').OTHER,c('MercuryFilters').ALL);}.bind(this);var u=t.getFlyout();this.$JewelThreadlistControl1=c('DOM').find(u,"._3v_l");this.$JewelThreadlistControl2=c('MessagingTag').INBOX;this.$JewelThreadlistControl3=c('MercuryFilters').ALL;this.$JewelThreadlistControl4=c('CurrentUser').getID();this.$JewelThreadlistControl5={};this.$JewelThreadlistControl6={};this.$JewelThreadlistControl5[c('MessagingTag').INBOX]=c('DOM').find(u,"._1sde");this.$JewelThreadlistControl6[c('MessagingTag').INBOX]=c('DOM').find(u,"._1sdg");c('Event').listen(this.$JewelThreadlistControl5[c('MessagingTag').INBOX],'click',function(){return this.$JewelThreadlistControl7(c('MessagingTag').INBOX,c('MercuryFilters').ALL);}.bind(this));if(!c('MercuryConfig').JewelRequestsUI){this.$JewelThreadlistControl5[n]=c('DOM').find(u,"._1sdf");this.$JewelThreadlistControl6[n]=c('DOM').find(u,"._1sdh");c('Event').listen(this.$JewelThreadlistControl5[n],'click',function(){return this.$JewelThreadlistControl7(n,c('MercuryFilters').ALL);}.bind(this));}else{this.$JewelThreadlistControl5[o]=c('DOM').find(u,"._34zq");c('Event').listen(this.$JewelThreadlistControl5[o],'click',function(){return this.$JewelThreadlistControl7(c('MessagingTag').INBOX,c('MercuryFilters').ALL);}.bind(this));}this.$JewelThreadlistControl8=c('DOM').find(u,"._1c1m");this.$JewelThreadlistControl9=c('DOM').find(u,"._4djt");this.$JewelThreadlistControl10=c('MercuryUnreadState').get();c('Event').listen(this.$JewelThreadlistControl8,'click',function(v){this.$JewelThreadlistControl11();v.kill();}.bind(this));c('MercuryThreadInformer').get().subscribe('unread-updated',function(){return this.$JewelThreadlistControl12();}.bind(this));this.$JewelThreadlistControl12();this.$JewelThreadlistControl13(u);this.render();m.bump('opened_threadlist_'+this.$JewelThreadlistControl2);}s.prototype.$JewelThreadlistControl13=function(t){'use strict';var u=c('MercuryConfig').PagesTabConfig;if(!u)return;this.$JewelThreadlistControl5[c('MessagingTag').PAGES]=c('DOM').find(t,"._481w");this.$JewelThreadlistControl6[c('MessagingTag').PAGES]=c('DOM').find(t,"._37p3");this.$JewelThreadlistControl14=c('MercuryConfig').PagesTabConfig.pageID;this.$JewelThreadlistControl15=c('MercuryUnreadState').getForFBID(this.$JewelThreadlistControl14);c('Event').listen(this.$JewelThreadlistControl5[c('MessagingTag').PAGES],'click',function(){c('PagesEventObserver').notify('biz_conv_page_tab_click',this.$JewelThreadlistControl14,{'unread-count':this.$JewelThreadlistControl15.getUnreadCount(p)},false);this.$JewelThreadlistControl7(c('MessagingTag').PAGES,c('MercuryFilters').ALL);}.bind(this));c('MercuryThreadInformer').getForFBID(this.$JewelThreadlistControl14).subscribe('unread-updated',function(){return this.$JewelThreadlistControl16();}.bind(this));this.$JewelThreadlistControl16();this.changeTabIfNecessary();};s.prototype.changeTabIfNecessary=function(){'use strict';var t=c('MercuryUnseenState').get().getUnseenCount();if(t>0&&this.$JewelThreadlistControl4===this.$JewelThreadlistControl14)this.$JewelThreadlistControl7(c('MessagingTag').INBOX,c('MercuryFilters').ALL);if(this.$JewelThreadlistControl14){var u=c('MercuryUnseenState').getForFBID(this.$JewelThreadlistControl14).getUnseenCount();if(c('MercuryConfig').PagesTabConfig.unseenJewelEnabled&&u>0&&t===0)this.$JewelThreadlistControl7(c('MessagingTag').PAGES,c('MercuryFilters').ALL);}};s.prototype.render=function(){'use strict';if(this.$JewelThreadlistControl4==c('CurrentUser').getID()){c('ReactDOM').render(c('React').createElement(c('MercuryThreadlistContainer.react'),{ChildClass:c('MessagesJewelThreadList.react'),viewer:this.$JewelThreadlistControl4,folder:this.$JewelThreadlistControl2,filter:this.$JewelThreadlistControl3,jewelRequestsUI:c('MercuryConfig').JewelRequestsUI,onMessageRequestsClick:this.$JewelThreadlistControl17,onFilteredRequestsClick:this.$JewelThreadlistControl18}),this.$JewelThreadlistControl1);}else c('ReactDOM').render(c('React').createElement(c('BootloadedComponent.react'),{bootloadLoader:c('JSResource')('PagesMessengerThreadlistContainer.react').__setRef('MercuryJewelThreadlistControl'),bootloadPlaceholder:c('React').createElement(c('XUISpinner.react'),{className:"jewelLoading"}),pageID:this.$JewelThreadlistControl4,config:c('MercuryConfig').PagesTabConfig}),this.$JewelThreadlistControl1);};s.prototype.$JewelThreadlistControl11=function(){'use strict';if(this.$JewelThreadlistControl4==c('CurrentUser').getID()){this.$JewelThreadlistControl10.markFolderAsRead(this.$JewelThreadlistControl2);}else this.$JewelThreadlistControl15.markFolderAsRead(c('MessagingTag').INBOX);};s.prototype.$JewelThreadlistControl7=function(t,u){'use strict';if(this.$JewelThreadlistControl2!==t||this.$JewelThreadlistControl3!==u){var v=this.$JewelThreadlistControl2,w=t===c('MessagingTag').INBOX,x=t;m.bump('opened_threadlist_'+t);if(this.$JewelThreadlistControl5[x])c('CSS').addClass(this.$JewelThreadlistControl5[x],"_1sdd");if(this.$JewelThreadlistControl5[v])c('CSS').removeClass(this.$JewelThreadlistControl5[v],"_1sdd");this.$JewelThreadlistControl2=t;this.$JewelThreadlistControl3=u;if(w){this.$JewelThreadlistControl9.href=c('MessengerURIConstants').FACEBOOK_PREFIX;this.$JewelThreadlistControl9.text=q;this.$JewelThreadlistControl4=c('CurrentUser').getID();}else if(t==n){this.$JewelThreadlistControl9.href=c('MessengerURIConstants').FACEBOOK_PREFIX+c('MessengerURIConstants').MESSAGE_REQUESTS_PATH;this.$JewelThreadlistControl9.text=q;this.$JewelThreadlistControl4=c('CurrentUser').getID();}else if(t==c('MessagingTag').PAGES){this.$JewelThreadlistControl4=this.$JewelThreadlistControl14;this.$JewelThreadlistControl9.href=c('MercuryConfig').PagesTabConfig.pageMessageURI;this.$JewelThreadlistControl9.text=r;}if(c('MercuryConfig').JewelRequestsUI){c('CSS').conditionShow(this.$JewelThreadlistControl5[c('MessagingTag').INBOX],w);c('CSS').conditionShow(this.$JewelThreadlistControl5[o],!w);}this.render();}};s.prototype.$JewelThreadlistControl12=function(){'use strict';this.$JewelThreadlistControl19(c('MessagingTag').INBOX);if(!c('MercuryConfig').JewelRequestsUI)this.$JewelThreadlistControl19(n);};s.prototype.$JewelThreadlistControl16=function(){'use strict';var t=void 0;if(this.$JewelThreadlistControl15.exceedsMaxCount(p)){t=c('MercuryThreadlistConstants').MAX_UNREAD_COUNT;}else t=this.$JewelThreadlistControl15.getUnreadCount(p);this.$JewelThreadlistControl20(t,c('MessagingTag').PAGES);};s.prototype.$JewelThreadlistControl19=function(t){'use strict';var u=void 0;if(this.$JewelThreadlistControl10.exceedsMaxCount(t)){u=c('MercuryThreadlistConstants').MAX_UNREAD_COUNT;}else u=this.$JewelThreadlistControl10.getUnreadCount(t);this.$JewelThreadlistControl20(u,t);};s.prototype.$JewelThreadlistControl20=function(t,u){'use strict';var v=this.$JewelThreadlistControl6[u];if(!v)return;var w=t?t.toString():0;if(t>0){if(t==c('MercuryThreadlistConstants').MAX_UNREAD_COUNT)w+='+';c('DOM').setContent(v,j._("({unread_count})",[j.param('unread_count',w)]));}else c('DOM').setContent(v,'');};f.exports=s;}),null);
__d('MercuryJewel',['Arbiter','EventProfiler','MercuryJewelCountControl','MercuryMessengerJewelPerfConfig','MercuryServerPayloadPreprocessor'],(function a(b,c,d,e,f,g){var h=false,i=false,j=null;function k(l,m){'use strict';c('MercuryJewelCountControl').constructStores(m);Object.keys(m).forEach(function(n){c('MercuryServerPayloadPreprocessor').getForFBID(n).handleUpdate(m[n]);});this.$MercuryJewel1=new (c('MercuryJewelCountControl'))(l,m);l.subscribeOnce('opened',function(){this.$MercuryJewel2(l);}.bind(this));l.subscribe('open',function(){this.$MercuryJewel3(l);this.$MercuryJewel4();}.bind(this));if(c('MercuryMessengerJewelPerfConfig').eagerLoadingOnBadge)l.subscribe('updated',function(n,o){if(o&&o.count>0)this.$MercuryJewel2(l);}.bind(this));}k.prototype.$MercuryJewel2=function(l){'use strict';this.$MercuryJewel3(l);if(!h){h=true;if(!l.isOpen())j=c('EventProfiler').notifyRunningEagerInteraction(l.getRoot(),'click');e(['MercuryJewelThreadlistControl'],function(m){this.$MercuryJewel5=new m(l);}.bind(this));c('Arbiter').inform('mercury-jewel/opened',null,c('Arbiter').BEHAVIOR_STATE);}};k.prototype.$MercuryJewel4=function(){'use strict';this.$MercuryJewel5&&this.$MercuryJewel5.changeTabIfNecessary();};k.prototype.$MercuryJewel3=function(l){'use strict';if(!i&&l.isOpen()){i=true;c('EventProfiler').tagCurrentActiveInteractionsAs('FirstMercuryJewelOpen');if(j)j();}};f.exports=k;}),null);