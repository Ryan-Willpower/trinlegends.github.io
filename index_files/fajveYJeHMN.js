if (self.CavalryLogger) { CavalryLogger.start_js(["VQISt"]); }

__d("XAssociateGroupThreadController",["XController"],(function a(b,c,d,e,f,g){f.exports=c("XController").create("\/groups\/messenger\/associate_group_thread\/",{});}),null);
__d("XGroupSideConversationCreateController",["XController"],(function a(b,c,d,e,f,g){f.exports=c("XController").create("\/groups\/side_conversation\/",{post_id:{type:"Int"}});}),null);
__d('MultiChatController',['AsyncRequest','AsyncSignal','ChatOpenTabEventLogger','FantaTabActions','Form','MercuryDispatcher','MercuryIDs','MercuryLocalIDs','MercuryThreadIDMap','MercuryViewer','MercuryServerDispatcher','MercuryThreads','XAssociateGroupThreadController','XGroupSideConversationCreateController'],(function a(b,c,d,e,f,g){var h=c('MercuryDispatcher').get(),i=c('MercuryThreadIDMap').get(),j=c('MercuryThreads').get(),k=c('XGroupSideConversationCreateController').getURIBuilder().getURI().toString(),l=c('XAssociateGroupThreadController').getURIBuilder().getURI().toString();function m(){}Object.assign(m,{subscribe:function o(p,q){p.subscribe('confirm',function(){this.createGroupThreadFromChooserDialog(p,q);}.bind(this));},subscribeFromPost:function o(p,q){p.subscribe('confirm',function(){this.createGroupPostThreadFromChooserDialog(p,q);}.bind(this));},createGroupPostThreadFromChooserDialog:function o(p,q){var r=c('Form').serialize(p.getRoot()),s=JSON.parse(r.profileChooserItems),t=Object.keys(s).filter(function(u){return !!s[u];});m.createThreadForFBIDs(t);new (c('AsyncRequest'))().setURI(k).setData({post_id:q}).send();p.hide();},createGroupThreadFromChooserDialog:function o(p,q){var r=c('Form').serialize(p.getRoot()),s=JSON.parse(r.profileChooserItems),t=[];for(var u in s)if(s[u])t.push(u);var v=m.createThreadForFBIDs(t),w=h.subscribe('update-thread-ids',function(x,y){for(var z in y)if(y[z]==v){var aa=j.getThreadMetaNow(v),ba=i.getServerIDFromClientIDNow(v);if(aa&&!aa.is_canonical&&ba)c('MercuryServerDispatcher').trySend(l,{group_id:q,thread_id:ba});new (c('AsyncSignal'))('/ajax/groups/chat/log',{group_id:q,message_id:z}).send();h.unsubscribe(w);break;}});p.hide();},createThreadForTokens:function o(p){var q=c('MercuryViewer').getID();if(!p.length)return;p=p.filter(function(s){return s!==q;});var r;if(p.length===0){return;}else if(p.length===1){r=c('MercuryIDs').getThreadIDFromParticipantID(p[0]);c('FantaTabActions').openTab(r,'created_locally_from_tokens');c('ChatOpenTabEventLogger').log('ChatTabView',r);}else{r=c('MercuryLocalIDs').generateThreadID();p.unshift(q);j.createNewLocalThread(r,p);c('FantaTabActions').openTab(r,'created_locally_from_tokens');c('ChatOpenTabEventLogger').log('MultiChatController',r);}return r;},createThreadForFBIDs:function o(p){var q=[];for(var r=0;r<p.length;r++)q.push('fbid:'+p[r]);return m.createThreadForTokens(q);}});var n={};n[l]={mode:c('MercuryServerDispatcher').IMMEDIATE};c('MercuryServerDispatcher').registerEndpoints(n);f.exports=m;}),null);
__d('FantaReducersSendMessages',['AsyncRequest','Bootloader','ChatTabViewEvents','EmojiLikeUtils','EmojiState','FantaMessageActions','FantaTabActions','FantaTypeFileUploader','FantaTypeSharePreview','FantaTypeTabContents','MercuryAPIArgsSource','mercuryBlockedParticipantsRe','MercuryIDs','MercuryLogMessageType','MercuryMessageActions','MercuryMessageObject','MercuryParticipants','MercurySheetPolicy','MercurySourceType','MercuryThreadActions','MercuryThreadIDMap','MercuryThreadInfo','MercuryThreads','MessageRequestUtils','MessengerAdminGroupUtils','MessengerEmojiUsageUtils','messengerUploadFilesUtilRe','MultiChatController','SiteData','XMessagingSetThreadStateController','getPageIDFromThreadID','setImmediate'],(function a(b,c,d,e,f,g){'use strict';var h=c('mercuryBlockedParticipantsRe').get(),i=c('MercuryMessageActions').get(),j=c('MercuryMessageObject').get(),k=c('MercuryThreadActions').get(),l=c('MercuryThreadIDMap').get(),m=c('MercuryThreads').get(),n=c('FantaMessageActions').Types,o=/^\s*$/,p='/ajax/chat/multichat/name_conversation/dismiss.php';function q(y,z){switch(z.type){case n.UPDATE_GROUP_NAME:var aa=z.threadID,ba=z.newName,ca=y.mercury.tabContents.get(aa);if(!ca)return y;var da=ca.thread;if(!da)return y;var ea=da.name,fa=c('MessengerAdminGroupUtils').isJoinableThread(da);if((ba||ea)&&ba!==ea)if(!fa){i.send(j.constructLogMessageObject(c('MercurySourceType').CHAT_WEB,aa,c('MercuryLogMessageType').THREAD_NAME,{name:ba}),null,c('MercuryAPIArgsSource').CHAT);}else l.getServerIDFromClientID(aa,function(ga){var ha=c('XMessagingSetThreadStateController').getURIBuilder().getURI();new (c('AsyncRequest'))().setURI(ha).setData({thread_id:ga,thread_name:ba}).send();});l.getServerIDFromClientID(aa,function(ga){new (c('AsyncRequest'))(p).setData({thread_fbid:ga}).send();});y=y.mergeIn(['mercury','tabContents',aa],{openSheet:null});}return y;}function r(y,z){switch(z.type){case n.SEND_GROUP_MESSAGE:var aa=z.threadID,ba=y.mercury.tabContents.get(aa),ca=ba.thread,da=ba.typeahead;if(!da||!ca)return y;var ea=da.getSelectedParticipantIDs();if(ca.is_canonical_user){var fa=ca.participants;c('setImmediate')(function(){return c('MultiChatController').createThreadForTokens(fa.concat(ea));});}else{var ga=c('MessengerAdminGroupUtils').shouldInvite(ca);if(ga){ea.forEach(function(ia){var ja=c('MercuryIDs').getThreadIDFromParticipantID(ia);if(ja)i.send(j.constructUserGeneratedMessageObject(ca.joinable_mode.link,c('MercurySourceType').CHAT_WEB,ja));});}else i.send(j.constructLogMessageObject(c('MercurySourceType').CHAT_WEB,aa,c('MercuryLogMessageType').SUBSCRIBE,{added_participants:ea}));}var ha=z.tabID||z.threadID;y=y.mergeIn(['mercury','tabContents',ha],{typeahead:null});}return y;}function s(y,z){var aa,ba;switch(z.type){case n.SEND_HOT_LIKE:case n.SEND_MESSAGE:case n.SEND_PHOTO:case n.SEND_STICKER:var ca=z.message,da=z.threadID,ea=ca?ca.mentions:null;if(ca)ca=ca.message;var fa=z.emoji,ga=z.onSendSuccess,ha=z.photoData,ia=z.size,ja=z.source,ka=z.stickerID,la=y.mercury.tabContents.get(da),ma=la.fileUploader,na=la.sharePreview,oa=la.signatureID,pa=la.threadPreviewID,qa=la.threadPreviewRecipients;da=pa||da;var ra=la.thread,sa=!!(!ca&&fa&&ia),ta=!!(!ca&&ka);if(sa){ca=fa;}else if(ta||ha)ca='';var ua=ra&&ra.is_canonical&&!c('MercuryThreadInfo').canReply(ra),va=!!(na.params&&na.type);if(t(ma,na)){y=y.mergeIn(['mercury','tabContents',da],{openSheet:c('MercurySheetPolicy').sheets.ChatUploadWarningTabSheet});}else if(ua&&ra){u(ra);}else if(!o.test(ca)||ma.uploadedFiles.size>0||va||ta||ha){var wa=c('MessengerEmojiUsageUtils').findAllEmojis(ca);if(wa.length>0)c('EmojiState').updateRecentlyUsed(wa);var xa=ma.getTypeIDs(c('FantaTypeFileUploader').fileTypes.GENERIC_ATTACHMENT),ya=v(da,ca,xa,na,sa,ma,ia,ja,ta,ka,ha,qa,ea,oa);if(ya&&ga){if(y.mercury.tabContents.get(da))y=y.mergeIn(['mercury','tabContents',da],{fileUploader:new (c('FantaTypeFileUploader'))(),sharePreview:new (c('FantaTypeSharePreview'))()});ga(ya);if(pa)(function(){var za=z.threadID;if(!y.mercury.tabContents.get(pa))y=y.setIn(['mercury','tabContents',pa],new (c('FantaTypeTabContents'))({id:pa}));c('setImmediate')(function(){return c('FantaTabActions').replaceTab(za,pa);});})();}}if(!t(ma,na))y=y.mergeIn(['mercury','tabContents',da],{openSheet:null});if(!pa&&qa&&qa.size>1)(function(){var za=y.tabGroup.tabs.get(z.threadID),ab=void 0;switch(za&&za.entryPoint){case 'compose_link':ab='chat_sidebar_new_message';break;case 'jewel_new_message':ab='jewel_new_message';break;case 'created_locally_from_tokens':ab='one_to_one_plus';break;default:ab=null;break;}c('Bootloader').loadModules(["MessengerWebChatEventsTypedLogger","MessengerWebChatEventType"],function(bb,cb){new bb().setEvent(cb.CLICK_NEW_MESSAGE).setEntryPoint(ab).log();},'FantaReducersSendMessages');})();return y;}return y;}function t(y,z){return !!(y.uploadingFiles.size>0);}function u(y){var z=y.thread_id,aa=c('MercuryIDs').getParticipantIDFromFromThreadID(z);if(aa&&y)c('MercuryParticipants').get(aa,function(ba){c('Bootloader').loadModules(["MessageBlockedDialog"],function(ca){ca.show(z,y.can_reply,h.isMessageBlocked(y),ba.short_name);},'FantaReducersSendMessages');});}function v(y,z,aa,ba,ca,da,ea,fa,ga,ha,ia,ja,ka,la){if(!fa)fa=c('MercurySourceType').CHAT_WEB;var ma=j.constructUserGeneratedMessageObject(z,c('MercurySourceType').CHAT_WEB,y);if(aa.length>0){ma.has_attachment=true;ma.raw_attachments=aa;}if(ka&&ka.length)ma.profile_ranges=ma.profile_xmd=ka;if(ga){ma.has_attachment=true;ma.sticker_id=ha;}if(!ca&&ba.params&&ba.type){var na={share_params:ba.params.get('data'),share_type:ba.type};if(na){ma.has_attachment=true;ma.shareable_attachment=na;}}ma.signatureID=la;ma.ui_push_phase=c('SiteData').push_phase;if(ia){ma.content_attachment=null;i.addAttachmentPlaceholder(ma,ia.upload_id,ia);}else if(!ca){if(z||ma.has_attachment)w(ma,y,ja);x(da,y,ja);}else if(ea&&fa){ma.has_attachment=false;i.send(function(){c('EmojiLikeUtils').setEmojiSize(ma,ea||'');return c('EmojiLikeUtils').setEmojiSource(ma,fa||'');}());}k.markRead(y);k.markSeen(y);return ma;}function w(y,z,aa){if(m.isEmptyLocalThread(z)){if(aa)k.addParticipants(z,aa.toArray());y.offline_threading_id=c('MercuryIDs').tokenize(z).value;var ba=m.getThreadMetaNow(z);if(ba)y.specific_to_list=Array.from(ba.participants);}i.send(y,function(ca){var da=m.getThreadMetaNow(ca);if(da&&c('MessageRequestUtils').isMessageRequest(da))k.movePendingToInbox(ca);if(da&&da.other_user_fbid&&c('getPageIDFromThreadID')(da.other_user_fbid))c('ChatTabViewEvents').inform('chat-send-to-page',{pageID:da.other_user_fbid});});}function x(y,z,aa){if(y.uploadedFiles.size===0)return;var ba=c('messengerUploadFilesUtilRe').supportAttachments;for(var ca in ba){var da=c('messengerUploadFilesUtilRe').getAttachmentIDs(y,ca);if(Array.isArray(da)){var ea=j.constructAttachmentMessageObject(c('MercurySourceType').CHAT_WEB,z);ea[ba[ca]]=da;w(ea,z,aa);}}}f.exports={sendGroupMessage:r,sendMessage:s,updateGroupName:q};}),null);