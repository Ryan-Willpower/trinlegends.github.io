if (self.CavalryLogger) { CavalryLogger.start_js(["UbZcT"]); }

__d('ChatTabPolicy',['ChatBehavior','LogHistory','MercuryActionType','MercuryLogMessageType','MercuryAssert','mercuryBlockedParticipantsRe','MercuryIDs','MercuryParticipantTypes','MercurySourceType','MercuryThreadActions','MercuryThreadInfo','MercuryViewer','MessagingTag','OzConstants','PresencePrivacy','Set','ShortProfiles','WorkModeConfig','isInFocusMode'],(function a(b,c,d,e,f,g){'use strict';var h=c('mercuryBlockedParticipantsRe').get(),i=c('MercuryThreadActions').get(),j=c('OzConstants').M_FBIDS,k=j.M_DEV,l=j.M,m=j.P,n=new (c('Set'))([k,l,m]),o=c('LogHistory').getInstance('tab_policy');f.exports={messageIsAllowed:function p(q,r,s){var t=q.thread_id,u=r.message_id,v=c('MercuryIDs').getUserIDFromParticipantID(c('MercuryViewer').getID());c('MercuryAssert').isThreadID(t);c('MercuryAssert').isParticipantID(r.author);var w=void 0;if(c('MercuryThreadInfo').isMuted(q)){w={thread_id:t,message_id:u,mute_until:q.mute_until};o.log('message_thread_muted',JSON.stringify(w));if(!c('MercuryThreadInfo').areMentionsMuted(q)){if(!r.profile_ranges||!r.profile_ranges.some||!r.profile_ranges.some(function(y){return y.id===v;})){o.log('message_mentions_viewer',JSON.stringify(w));return;}}else return;}if(c('isInFocusMode')(t)){w={thread_id:t,message_id:u,availability_mode:'focus'};o.log('message_thread_focus_mode',JSON.stringify(w));return;}if(q.read_only){w={thread_id:t,message_id:u,mode:q.mode};o.log('message_read_only',JSON.stringify(w));return;}if(r.source==c('MercurySourceType').EMAIL||r.source==c('MercurySourceType').TITAN_EMAIL_REPLY){w={thread_id:t,message_id:u,source:r.source};o.log('message_source_not_allowed',JSON.stringify(w));return;}var x=c('MercuryIDs').getUserIDFromParticipantID(r.author);if(!x){o.log('message_bad_author',JSON.stringify({thread_id:t,message_id:u,user:x}));return;}if(r.action_type!=c('MercuryActionType').USER_GENERATED_MESSAGE&&!this._messageIsNewlyCreatedGroup(r,q)){w={thread_id:t,message_id:u,type:r.action_type};o.log('message_non_user_generated',JSON.stringify(w));return;}if(q.is_canonical_user&&!c('ChatBehavior').notifiesUserMessages()){o.log('message_jabber',JSON.stringify({thread_id:t,message_id:u}));i.markSeen(t,true);return;}if(q.is_canonical&&!q.other_user_fbid){o.log('message_canonical_contact',JSON.stringify({thread_id:t,message_id:u}));return;}if(q.folder!=c('MessagingTag').INBOX){o.log('message_folder',JSON.stringify({thread_id:t,message_id:u,folder:q.folder}));return;}if(h.isPresentInGroupThread(q)){w={thread_id:t,message_id:u};o.log('message_blocked_participants',JSON.stringify(w));return;}c('ShortProfiles').getMulti([x,v],function(y){if(!c('PresencePrivacy').allows(x)){o.log('message_privacy',JSON.stringify({thread_id:t,message_id:u,user:x}));return;}var z=y[x].employee&&y[v].employee,aa=c('WorkModeConfig').is_work_user;if(!z&&!aa&&!y[x].isCommercePage&&!n.has(x)&&y[x].type!==c('MercuryParticipantTypes').FRIEND&&y[x].type!==c('MercuryParticipantTypes').PAGE){o.log('message_non_friend',JSON.stringify({thread_id:t,message_id:u,user:x}));return;}s();});},_messageIsNewlyCreatedGroup:function p(q,r){return q.action_type===c('MercuryActionType').LOG_MESSAGE&&q.log_message_type===c('MercuryLogMessageType').THREAD_NAME&&r.message_count===1;}};}),null);
__d('FantaReducersSharePreview',['Bootloader','FantaMessageActions','FantaTabActions','FantaTypeSharePreview','immutable','ifRequired','setImmediate'],(function a(b,c,d,e,f,g){'use strict';var h=c('FantaMessageActions').Types,i=c('FantaTabActions').Types,j='scraperLastPermissiveMatch';function k(r,s){switch(s.type){case h.COMPOSER_TEXT_UPDATE:var t=s.message,u=s.threadID;r=l(r,t,u);}return r;}function l(r,s,t){c('ifRequired')('URLMatcher',function(u){c('ifRequired')('DataStore',function(v){if(s.length===0){v.remove(t,j);}else{if(!r.mercury.tabContents.get(t))return r;if(!u.trigger(s+' ')){var w=u.match(s),x=u.permissiveMatch(s);if(x&&x!==v.get(t,j)){v.set(t,j,x);r=r.mergeIn(['mercury','tabContents',t,'sharePreview'],{params:null,type:null,uri:w||x});}}}});},function(){c('Bootloader').loadModules(["URLMatcher","DataStore"],function(u,v){if(s.length>0)c('setImmediate')(function(){c('FantaMessageActions').composerTextUpdate(t,s);});},'FantaReducersSharePreview');});return r;}function m(r,s){switch(s.type){case h.LINK_PREVIEW:var t=s.uri,u=s.tabID;if(!r.mercury.tabContents.get(u))return r;r=r.mergeIn(['mercury','tabContents',u,'sharePreview'],{params:null,type:null,uri:t});}return r;}function n(r,s){switch(s.type){case h.LOADED_SHARE_DATA:var t=s.attachmentData,u=s.tabID,v=t.share_data;if(!r.mercury.tabContents.get(u))return r;r=r.mergeIn(['mercury','tabContents',u,'sharePreview'],{isLoading:false,params:c('immutable').Map({data:v.share_params}),type:v.share_type});}return r;}function o(r,s){switch(s.type){case h.LOADING_SHARE_DATA:var t=s.tabID;if(!r.mercury.tabContents.get(t))return r;r=r.mergeIn(['mercury','tabContents',t,'sharePreview'],{isLoading:true,params:null,type:null});}return r;}function p(r,s){switch(s.type){case i.CLOSE_ALL_TABS:var t=r.tabGroup.tabs.keys();for(var u=t,v=Array.isArray(u),w=0,u=v?u:u[typeof Symbol==='function'?Symbol.iterator:'@@iterator']();;){var x;if(v){if(w>=u.length)break;x=u[w++];}else{w=u.next();if(w.done)break;x=w.value;}var y=x;r=q(r,y);}break;case i.CLOSE_TAB:case i.CLOSE_AND_TAB_NEXT:case h.REMOVE_SHARE_PREVIEW:var z=s.tabID;r=q(r,z);}return r;}function q(r,s){if(!r.mercury.tabContents.get(s))return r;return r.setIn(['mercury','tabContents',s,'sharePreview'],new (c('FantaTypeSharePreview'))());}f.exports={closeTab:p,composerTextUpdate:k,linkPreview:m,loadedShareData:n,loadingShareData:o};}),null);